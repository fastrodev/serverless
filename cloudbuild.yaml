steps:
  - name: gcr.io/google.com/cloudsdktool/cloud-sdk:alpine
    entrypoint: /bin/bash
    args:
    - -c
    - | 
      gcloud secrets versions access latest  --secret=firestore-ads > firestore.json
      export GOOGLE_APPLICATION_CREDENTIALS=firestore.json
      gcloud secrets versions access latest  --secret=aws-lambda > .env
      if [ ! -f .env ]
      then
        export $(cat .env | xargs)
      fi
  - name: golang:alpine
    entrypoint: /bin/ash
    args:
    - -c
    - | 
      mkdir public
      mv template/iklan.png public
      go run cmd/static/main.go
  - name: gcr.io/google.com/cloudsdktool/cloud-sdk:alpine
    entrypoint: /bin/bash
    args:
    - -c
    - |
      gcloud functions deploy Main --source=. --trigger-http --allow-unauthenticated
